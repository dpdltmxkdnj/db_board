<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link th:href="@{/css/bootstrap.min.css}" href="css/bootstrap.min.css" rel="stylesheet">
    <title>Title</title>
</head>
<body>
    <div class="container" style="max-width: 600px">
        <div class="py-5">
            <h2 class="d-flex justify-content-center">ê¸€ ì •ë³´</h2>
            <div class="d-flex p-3">
                <div class="me-auto" th:text="${userText.username}">ìš°ê¹Œìš°ê¹Œê¾¸ </div>
                <div class="d-flex justify-content-end">

                    <div th:text="|ì¡°íšŒ: ${userText.texts[0].viewCount}|">ì¡°íšŒ:</div>
                </div>
            </div>
            <div class="mb-3">
                <label for="exampleFormControlInput1" class="form-label">ì œëª©</label>
                <input type="text" class="form-control" id="exampleFormControlInput1" th:field="${userText.texts[0].title}" disabled>
            </div>
            <div class="mb-3">
                <label for="exampleFormControlTextarea1" class="form-label">ë‚´ìš©</label>
                <textarea class="form-control" id="exampleFormControlTextarea1" style="resize: none;height: 300px" th:field="${userText.texts[0].text}" disabled></textarea>
            </div>

            <div style="display: flex;justify-content: center" class="mb-3">
                <button style="background-color:white;border:none;font-size: 35px" onclick="recommend()">ğŸ‘</button>
                <div  style="font-size: 35px"  class="mx-3" id="likeCount" th:text="'ì¶”ì²œ: '+${userText.texts[0].likeCount}">ì¶”ì²œ:</div>
            </div>
            <div class="d-flex justify-content-center">
                <div th:if="${isMyThing}">
                <button class="btn btn-primary  me-3"
                        type="button"
                        th:onclick="|location.href='@{/home/{contentId}/edit(contentId=${userText.texts[0].contentId})}'|"
                >ìˆ˜ì •í•˜ê¸°</button>
                </div>
                <div th:if="${!isMyThing}">
                    <button class="btn btn-primary  me-3"
                            type="button"
                            onclick="notMyThing()"
                    >ìˆ˜ì •í•˜ê¸°</button>
                </div>
                <button class="btn btn-primary  ms-3"
                        type="button"
                        onclick="goBack()"
                >ëŒì•„ê°€ê¸°</button>
            </div>
            <div class="my-3">
                <textarea class="form-control" style="resize: none;height: 100px" id="commentText"></textarea>
                <button th:if="${loginId!='anonymousUser'}" class="btn btn-primary float-end my-3" onclick="addComment()" >ëŒ“ê¸€ ë“±ë¡</button>
                <button th:if="${loginId=='anonymousUser'}" class="btn btn-primary float-end my-3" onclick="afterLoginComment()" >ëŒ“ê¸€ ë“±ë¡</button>

            </div>
            <table class="table table-hover text-center" style="table-layout: fixed;">
                <colgroup>
                    <col style="width: 10%">
                    <col style="width: 70%">
                    <col style="width: 20%">
                </colgroup>


                <tbody class="table-group-divider">
                    <tr th:each="comment:${comments}">
                        <td th:text="${comment.username}">dd</td>
                        <td th:text="${comment.text}" style="word-break: break-all"><p>ã…‹ã…‹zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz</p></td>
                        <td th:text="${comment.dateCreated}" style="font-size: 12px">2016.01.01 21:33:22</td>
                    </tr>
                </tbody>
            </table>

        </div>
    </div>
</body>
<script type="application/javascript" th:inline="javascript">
    let likeCount = [[${userText.texts[0].likeCount}]];
    let contentId = [[${userText.texts[0].contentId}]];
    function notMyThing() {
        alert("ì‘ì„±ìë§Œ ìˆ˜ì • ê°€ëŠ¥í•©ë‹ˆë‹¤.")
    }
    function goBack() {
        window.history.back();
    }
    function afterLoginComment() {
        alert("ë¡œê·¸ì¸ í›„ ëŒ“ê¸€ ì‘ì„± ê°€ëŠ¥í•©ë‹ˆë‹¤.")
    }

    // ì¶”ì²œ ë²„íŠ¼ í´ë¦­ì‹œ ì‹¤í–‰ë˜ëŠ” JavaScript í•¨ìˆ˜
    function recommend() {
        // ì¶”ì²œ ìˆ˜ 1 ì¦ê°€
        likeCount++;
        // AJAX í†µì‹ 
        fetch('/home/updateLikeCount', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                count: likeCount,
                id: contentId
            }),
        })
            .then(response => response.json())
            .then(data => {
                // ì„œë²„ì—ì„œ ë°›ì•„ì˜¨ ë°ì´í„°ë¡œ í™”ë©´ ì—…ë°ì´íŠ¸
                document.getElementById('likeCount').innerText = `ì¶”ì²œ: ${data.likeCount}`;
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }

    function addComment() {
        const commentText= document.getElementById('commentText').value;
        const tbody = document.querySelector('tbody');
        // AJAX í†µì‹ 
        fetch('/home/addComment', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                id: contentId,
                text:commentText
            }),
        })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                // ë°˜ë³µë¬¸ì„ í†µí•´ ì—¬ëŸ¬ ê°œì˜ <tr> ìƒì„±

                    // ìƒˆë¡œìš´ <tr> ìš”ì†Œ ìƒì„±
                    let tr = document.createElement('tr');

                    // ì²« ë²ˆì§¸ <td> ìƒì„±
                    let td1 = document.createElement('td');
                    td1.textContent = data.username;
                    tr.appendChild(td1);

                    // ë‘ ë²ˆì§¸ <td> ìƒì„±
                    let td2 = document.createElement('td');
                    td2.style.wordBreak = 'break-all';

                    let p = document.createElement('p');
                    p.textContent = data.text;
                    td2.appendChild(p);

                    tr.appendChild(td2);

                    // ì„¸ ë²ˆì§¸ <td> ìƒì„±
                    let td3 = document.createElement('td');
                    td3.style.fontSize = '12px';
                    td3.textContent = data.dateCreated;
                    tr.appendChild(td3);

                    // tbodyì— ìƒì„±í•œ <tr> ì¶”ê°€
                    tbody.appendChild(tr);

                    document.getElementById('commentText').value="";

                // document.getElementById('likeCount').innerText = `ì¶”ì²œ: ${data.likeCount}`;
            })
    }
</script>
</html>